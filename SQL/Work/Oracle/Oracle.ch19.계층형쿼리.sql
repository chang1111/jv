
-- ######################## 
-- WITH 구문
--  
-- WITH 구문내의 쿼리 결과(SUB쿼리)를 여러번 사용하고자 할 때 유용하다.
-- 서브쿼리 블럭에 이름을 지정할 수 있도록 해줌.
-- 오라클은 WITH 구문을 뷰나 일회용 테이블로 여긴다.
-- Oracle은 with 문을 지원
-- MsSQL with 문을 지원
-- MySQL은 WITH 문을 지원하지 않는다.
-- 
-- FROM 절에 서브쿼리를 사용하는 경우에는 WITH 문을 사용하시오.
--  
-- http://powerofwriting.tistory.com/entry/Oracle-WITH-구문-예제
-- ########################
 
 
-- @@@@@@@ 
-- 한개의 SUB쿼리를 사용하는 WITH 구문 사용방법
-- WITH ALIAS명 AS ( 
--    SUB쿼리 
-- )
-- SELECT 컬럼명 FROM ALIAS명;
-- @@@@@@@ 





-- @@@@@@@ 
-- 여러개의 SUB쿼리를 사용하는 WITH 구문
-- WITH ALIAS명_1 AS ( SUB쿼리 ),
--      ALIAS명_2 AS ( SUB쿼리 )
-- SELECT 컬럼명 FROM ALIAS명 where 조인조건;
-- @@@@@@@ 


  

 
 
-- ######################## 
-- 계층형 쿼리
--  
-- 답변형 게시판, 부서 조직도, 메뉴트리를 나타낼 때 사용한다.
-- 
-- 오라클에서는 SELECT 문에서 START WITH와 CONNECT BY 절을 이용하여 데이터를 계층적인 형태로 출력할 수 있다.
-- SELECT LEVEL, 컬럼1, 컬럼2, ...
-- FROM 테이블
-- WHERE 조건
-- START WITH 계층의 시작점이 될 행을 구별하는 논리식
-- CONNECT BY 계층을 구성할 때 사용될 논리식
--  
-- MySQL에서는 계층형 문법을 제공하지 않는다.
-- 계층형 데이터 출력을 위해서는 변수를 이용한다.
-- 
-- 
-- http://ndatabase.blogspot.kr/2013/07/blog-post_19.html
-- http://noritersand.tistory.com/4
-- ######################## 


-- id, pid, data 형태 테이블 tree를 만들고 데이터를 입력하시오.
-- +-------+-------------+------+-----+---------+-------+
-- | Field | Type        | Null | Key | Default | Extra |
-- +-------+-------------+------+-----+---------+-------+
-- | id    | int(11)     | YES  |     | NULL    |       |
-- | pid   | int(11)     | YES  |     | NULL    |       |
-- | data  | varchar(50) | YES  |     | NULL    |       |
-- +-------+-------------+------+-----+---------+-------+


-- 아래처럼 tree 테이블에 데이터를 입력하시오.
-- +------+------+----------+
-- | id   | pid  | data     |
-- +------+------+----------+
-- |    1 |    0 | 그림01   |
-- |    2 |    1 | 그림02   |
-- |    3 |    1 | 그림03   |
-- |    4 |    2 | 그림04   |
-- |    5 |    4 | 그림05   |
-- |    6 |    4 | 그림06   |
-- |    7 |    6 | 그림07   |
-- |    8 |    3 | 그림08   |
-- |    9 |    3 | 그림09   |
-- |   10 |    9 | 그림10   |
-- |   11 |    7 | 그림11   |
-- |   12 |    8 | 그림12   |
-- |   13 |   10 | 그림13   |
-- |   14 |   10 | 그림14   |
-- |   15 |   10 | 그림15   |
-- |   16 |   13 | 그림16   |
-- |   17 |   13 | 그림17   |
-- |   18 |   14 | 그림18   |
-- |   19 |   15 | 그림19   |
-- |   20 |   17 | 그림20   |
-- |   21 |    4 | 그림21   |
-- |   22 |   21 | 그림22   |
-- |   23 |    5 | 그림23   |
-- |   24 |   11 | 그림24   |
-- |   25 |   11 | 그림25   |
-- |   26 |   12 | 그림26   |
-- |   27 |    9 | 그림27   |
-- |   28 |   25 | 그림28   |
-- |   29 |   22 | 그림29   |
-- |   30 |    2 | 그림30   |
-- +------+------+----------+











-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.
--  +------+------------+-------+----------+
--  | _ID  | _PARENT_ID | level | data     |
--  +------+------------+-------+----------+
--  | 26   |         12 |     1 | 그림12   |
--  | 12   |          8 |     2 | 그림08   |
--  | 8    |          3 |     3 | 그림03   |
--  | 3    |          1 |     4 | 그림01   |
--  | 1    |          0 |     5 | NULL     |
--  +------+------------+-------+----------+
 

 
-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.
--  +------+--------+------+----------+
--  | _id  | parent | lvl  | data     |
--  +------+--------+------+----------+
--  |    1 |      0 |    4 | NULL     |
--  |    2 |      1 |    3 | 그림01   |
--  |    4 |      2 |    2 | 그림02   |
--  |    5 |      4 |    1 | 그림04   |
--  +------+--------+------+----------+
   

-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.
--  +---------------------------+------+-------+
--  | treeitem                  | pid  | level |
--  +---------------------------+------+-------+
--  |                         1 |    0 |     7 |
--  |                     2     |    1 |     6 |
--  |                 4         |    2 |     5 |
--  |             6             |    4 |     4 |
--  |         7                 |    6 |     3 |
--  |     11                    |    7 |     2 |
--  | 25                        |   11 |     1 |
--  +---------------------------+------+-------+
        

-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.      
--  +----------------------------+------+-------+
--  | treeitem                   | pid  | level |
--  +----------------------------+------+-------+
--  | 1                          |    0 |     1 |
--  |     2                      |    1 |     2 |
--  |         4                  |    2 |     3 |
--  |             6              |    4 |     4 |
--  |                 7          |    6 |     5 |
--  |                     11     |    7 |     6 |
--  |                         25 |   11 |     7 |
--  +----------------------------+------+-------+
 
 
 


-- @@@@@@@@@@
-- 미션 07. 
-- @@@@@@@@@
-- 1. 테이블 tree2 를 만드시오.
-- +-----------+-------------+------+-----+---------+-------+
-- | Field     | Type        | Null | Key | Default | Extra |
-- +-----------+-------------+------+-----+---------+-------+
-- | id        | int(11)     | YES  |     | NULL    |       |
-- | parent_id | int(11)     | YES  |     | NULL    |       |
-- | etc       | varchar(50) | YES  |     | NULL    |       |
-- +-----------+-------------+------+-----+---------+-------+


-- 2. 아래와 같이 tree2 테이블에 데이터를 입력하시오.
-- +------+-----------+------------+
-- | id   | parent_id | etc        |
-- +------+-----------+------------+
-- |    1 |         0 | ROOT       |
-- |    2 |         1 | CHILD      |
-- |    3 |         2 | CHILD OF 2 |
-- |    4 |         2 | CHILD OF 2 |
-- |    5 |         2 | CHILD OF 2 |
-- +------+-----------+------------+
	            

-- 3. 아래와 같이 출력하는 쿼리를 작성시오.
-- +------+------------+-----------+-------+
-- | _id  | etc        | parent_id | level |
-- +------+------------+-----------+-------+
-- | 1    | ROOT       |         0 |     3 |
-- | 2    | CHILD      |         1 |     2 |
-- | 5    | CHILD OF 2 |         2 |     1 |
-- +------+------------+-----------+-------+
   





 

-- @@@@@@@@@@@@@@@@@@@
-- https://explainextended.com/2009/03/17/hierarchical-queries-in-mysql/
-- @@@@@@@@@@@@@@@@@@@

-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오. 


   

-- @@@@@@@@@@@@@@@@@@@
-- https://explainextended.com/2009/07/20/hierarchical-data-in-mysql-parents-and-children-in-one-query/
-- @@@@@@@@@@@@@@@@@@@


-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.  
-- +------+--------+------+
-- | _id  | parent | lvl  |
-- +------+--------+------+
-- | 1218 |    165 |    1 |
-- | 165  |     38 |    2 |
-- | 38   |      7 |    3 |
-- | 7    |      2 |    4 |
-- | 2    |      1 |    5 |
-- | 1    |      0 |    6 |
-- +------+--------+------+



-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.  
-- +-----------------------+--------+-------+
-- | treeitem              | parent | level |
-- +-----------------------+--------+-------+
-- |                     1 |      0 | 6     |
-- |                 2     |      1 | 5     |
-- |             7         |      2 | 4     |
-- |         38            |      7 | 3     |
-- |     165               |     38 | 2     |
-- | 1218                  |    165 | 1     |
-- | 5473                  |   1218 | 1     |
-- |     24796             |   5473 | 2     |
-- |     24797             |   5473 | 2     |
-- |     24798             |   5473 | 2     |
-- |     24799             |   5473 | 2     |
-- |     24800             |   5473 | 2     |
-- | 5474                  |   1218 | 1     |
-- |     24801             |   5474 | 2     |
-- |     24802             |   5474 | 2     |
-- |     24803             |   5474 | 2     |
-- |     24804             |   5474 | 2     |
-- |     24805             |   5474 | 2     |
-- | 5475                  |   1218 | 1     |
-- |     24806             |   5475 | 2     |
-- |     24807             |   5475 | 2     |
-- |     24808             |   5475 | 2     |
-- |     24809             |   5475 | 2     |
-- |     24810             |   5475 | 2     |
-- | 5476                  |   1218 | 1     |
-- |     24811             |   5476 | 2     |
-- |     24812             |   5476 | 2     |
-- |     24813             |   5476 | 2     |
-- |     24814             |   5476 | 2     |
-- |     24815             |   5476 | 2     |
-- | 5477                  |   1218 | 1     |
-- |     24816             |   5477 | 2     |
-- |     24817             |   5477 | 2     |
-- |     24818             |   5477 | 2     |
-- |     24819             |   5477 | 2     |
-- |     24820             |   5477 | 2     |
-- +-----------------------+--------+-------+


-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오.  
-- +-----------------------+--------+-------+
-- | treeitem              | parent | level |
-- +-----------------------+--------+-------+
-- |                     1 |      0 |     6 |
-- |                 2     |      1 |     5 |
-- |             7         |      2 |     4 |
-- |         38            |      7 |     3 |
-- |     165               |     38 |     2 |
-- | 1218                  |    165 |     1 |
-- +-----------------------+--------+-------+


-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오. 
-- +--------------------------+--------+-------+
-- | treeitem                 | parent | level |
-- +--------------------------+--------+-------+
-- | 1                        |      0 |     1 |
-- |     2                    |      1 |     2 |
-- |         7                |      2 |     3 |
-- |             38           |      7 |     4 |
-- |                 165      |     38 |     5 |
-- |                     1218 |    165 |     6 |
-- +--------------------------+--------+-------+


-- 계층형 쿼리를 사용하여 아래와 같이 출력되게 하시오. 
-- +-----------------------------------------------------+--------+-------+
-- | CONCAT(REPEAT('    ', level - 1), CAST(id AS CHAR)) | parent | level |
-- +-----------------------------------------------------+--------+-------+
-- | 1                                                   |      0 |     1 |
-- |     2                                               |      1 |     2 |
-- |         7                                           |      2 |     3 |
-- |             38                                      |      7 |     4 |
-- |                 165                                 |     38 |     5 |
-- |                     1218                            |    165 |     6 |
-- |                         5473                        |   1218 |     7 |
-- |                             24796                   |   5473 |     8 |
-- |                             24797                   |   5473 |     8 |
-- |                             24798                   |   5473 |     8 |
-- |                             24799                   |   5473 |     8 |
-- |                             24800                   |   5473 |     8 |
-- |                         5474                        |   1218 |     7 |
-- |                             24801                   |   5474 |     8 |
-- |                             24802                   |   5474 |     8 |
-- |                             24803                   |   5474 |     8 |
-- |                             24804                   |   5474 |     8 |
-- |                             24805                   |   5474 |     8 |
-- |                         5475                        |   1218 |     7 |
-- |                             24806                   |   5475 |     8 |
-- |                             24807                   |   5475 |     8 |
-- |                             24808                   |   5475 |     8 |
-- |                             24809                   |   5475 |     8 |
-- |                             24810                   |   5475 |     8 |
-- |                         5476                        |   1218 |     7 |
-- |                             24811                   |   5476 |     8 |
-- |                             24812                   |   5476 |     8 |
-- |                             24813                   |   5476 |     8 |
-- |                             24814                   |   5476 |     8 |
-- |                             24815                   |   5476 |     8 |
-- |                         5477                        |   1218 |     7 |
-- |                             24816                   |   5477 |     8 |
-- |                             24817                   |   5477 |     8 |
-- |                             24818                   |   5477 |     8 |
-- |                             24819                   |   5477 |     8 |
-- |                             24820                   |   5477 |     8 |
-- +-----------------------------------------------------+--------+-------+
